---
title: ROS220-ROS2å·¥å…·ï¼šåæ ‡å˜æ¢ï¼ˆä¸‰ï¼‰åæ ‡å˜æ¢å¹¿æ’­
icon: 'map-pin'
date: 2026-01-29
category:
  - Computer
  - robot
  - ROS
---

## ç®€ä»‹

åæ ‡ç³»ç›¸å¯¹å…³ç³»ä¸»è¦æœ‰ä¸¤ç§ï¼šé™æ€åæ ‡ç³»ç›¸å¯¹å…³ç³»ä¸åŠ¨æ€åæ ‡ç³»ç›¸å¯¹å…³ç³»ï¼š

- `é™æ€åæ ‡ç³»ç›¸å¯¹å…³ç³»` æ˜¯æŒ‡ä¸¤ä¸ªåæ ‡ç³»ä¹‹é—´çš„ç›¸å¯¹ä½ç½®æ˜¯ **å›ºå®šä¸å˜** çš„ï¼Œæ¯”å¦‚ï¼šè½¦è¾†ä¸Šçš„é›·è¾¾ã€æ‘„åƒå¤´ç­‰ç»„ä»¶ä¸€èˆ¬æ˜¯å›ºå®šå¼çš„ï¼Œé‚£ä¹ˆé›·è¾¾åæ ‡ç³»ç›¸å¯¹äºè½¦è¾†åº•ç›˜åæ ‡ç³»æˆ–æ‘„åƒå¤´åæ ‡ç³»ç›¸å¯¹äºè½¦è¾†åº•ç›˜åæ ‡ç³»å°±æ˜¯ä¸€ç§é™æ€å…³ç³»ã€‚

- `åŠ¨æ€åæ ‡ç³»ç›¸å¯¹å…³ç³»` æ˜¯æŒ‡ä¸¤ä¸ªåæ ‡ç³»ä¹‹é—´çš„ç›¸å¯¹ä½ç½®å…³ç³»æ˜¯ **åŠ¨æ€æ”¹å˜** çš„ï¼Œæ¯”å¦‚ï¼šè½¦è¾†ä¸Šæœºæ¢°è‡‚çš„å…³èŠ‚æˆ–å¤¹çˆªã€å¤šè½¦ç¼–é˜Ÿä¸­ä¸åŒè½¦è¾†ç­‰éƒ½æ˜¯å¯ä»¥è¿åŠ¨çš„ï¼Œé‚£ä¹ˆæœºæ¢°è‡‚çš„å…³èŠ‚æˆ–å¤¹çˆªåæ ‡ç³»ç›¸å¯¹è½¦è¾†åº•ç›˜åæ ‡ç³»æˆ–ä¸åŒè½¦è¾†åæ ‡ç³»çš„ç›¸å¯¹å…³ç³»å°±æ˜¯ä¸€ç§åŠ¨æ€å…³ç³»ã€‚

æœ¬ç« ä¼šä¸»è¦ä»‹ç»å¦‚ä½•å®ç°é™æ€åæ ‡å˜æ¢å¹¿æ’­ä¸åŠ¨æ€åæ ‡å˜æ¢å¹¿æ’­ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œè¿˜ä¼šæ¼”ç¤ºå¦‚ä½•å‘å¸ƒåæ ‡ç‚¹æ¶ˆæ¯ã€‚

## æ¡ˆä¾‹æ¢³ç†

ä»¥ä¸‹æœ‰ä¸¤ä¸ªæ¡ˆä¾‹éœ€æ±‚ï¼š

1. æœ‰ä¸€æ— äººè½¦ï¼Œåœ¨æ— äººè½¦åº•ç›˜ä¸Šè£…æœ‰ **å›ºå®šå¼** çš„é›·è¾¾ä¸æ‘„åƒå¤´ã€‚è½¦è¾†åº•ç›˜ã€é›·è¾¾ä¸æ‘„åƒå¤´å„å¯¹åº”ä¸€åæ ‡ç³»ï¼Œä¸”å„åæ ‡ç³»çš„åŸç‚¹å–å…¶å‡ ä½•ä¸­å¿ƒã€‚ç°å·²çŸ¥*é›·è¾¾åæ ‡ç³»*ç›¸å¯¹äº*åº•ç›˜åæ ‡ç³»*çš„ä¸‰ç»´å¹³ç§»é‡åˆ†åˆ«ä¸ºï¼š`xæ–¹å‘0.4ç±³ï¼Œyæ–¹å‘0ç±³ï¼Œzæ–¹å‘0.2ç±³ï¼Œæ— æ—‹è½¬`ã€‚*æ‘„åƒå¤´åæ ‡ç³»*ç›¸å¯¹äº*åº•ç›˜åæ ‡ç³»*çš„ä¸‰ç»´å¹³ç§»é‡åˆ†åˆ«ä¸ºï¼š`xæ–¹å‘-0.5ç±³ï¼Œyæ–¹å‘0ç±³ï¼Œzæ–¹å‘0.4ç±³ï¼Œæ— æ—‹è½¬`ã€‚è¯· *é™æ€å¹¿æ’­* **é›·è¾¾ä¸åº•ç›˜çš„åæ ‡ç³»ç›¸å¯¹å…³ç³»**ä¸**æ‘„åƒå¤´ä¸åº•ç›˜çš„åæ ‡ç³»ç›¸å¯¹å…³ç³»**ï¼Œå¹¶åœ¨ `rviz2` ä¸­æŸ¥çœ‹å¹¿æ’­çš„ç»“æœã€‚
2. å¯åŠ¨ turtlesim_nodeï¼Œè®¾è¯¥èŠ‚ç‚¹ä¸­**çª—ä½“ä¸ºä¸€ä¸ªä¸–ç•Œåæ ‡ç³»**(å·¦ä¸‹è§’ä¸ºåæ ‡ç³»åŸç‚¹)ï¼Œ**ä¹Œé¾Ÿæ˜¯å¦ä¸€ä¸ªåæ ‡ç³»**(ä¹Œé¾Ÿå¯ä»¥é€šè¿‡é”®ç›˜æ§åˆ¶è¿åŠ¨)ï¼Œè¯· *åŠ¨æ€å¹¿æ’­* **ä¹Œé¾Ÿåæ ‡ç³»ä¸ä¸–ç•Œåæ ‡ç³»çš„ç›¸å¯¹å…³ç³»**ã€‚

åœ¨ä¸Šè¿°æ¡ˆä¾‹ä¸­ï¼Œ**æ¡ˆä¾‹1**éœ€è¦ä½¿ç”¨åˆ°*é™æ€åæ ‡å˜æ¢*ï¼Œ**æ¡ˆä¾‹2**åˆ™éœ€è¦ä½¿ç”¨*åŠ¨æ€åæ ‡å˜æ¢*ï¼Œä¸è®ºä½•ç§å®ç°å…¶å…³æ³¨çš„è¦ç´ éƒ½æœ‰ä¸¤ä¸ªï¼š

1. å¦‚ä½•å¹¿æ’­åæ ‡ç³»ç›¸å¯¹å…³ç³»ï¼›
2. å¦‚ä½•ä½¿ç”¨ rviz2 æ˜¾ç¤ºåæ ‡ç³»ç›¸å¯¹å…³ç³»ã€‚

è¿™ä¸¤ç§å®ç°çš„é€šç”¨ä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š

1. ç¼–å†™å¹¿æ’­å®ç°åŸæ–‡ä»¶ï¼›
2. ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼›
3. ç¼–è¯‘ï¼›
4. è¿è¡Œï¼›
5. åœ¨ rviz2 ä¸­æŸ¥çœ‹åæ ‡ç³»å…³ç³»ã€‚

ä»¥ç¼–ç æ–¹å¼å®ç°é™æ€åæ ‡å˜æ¢çš„æµç¨‹ä¸å®ç°åŠ¨æ€åæ ‡å˜æ¢çš„æµç¨‹ç›¸ç±»ä¼¼ï¼Œè¿™ä¸¤ä¸ªæ¡ˆä¾‹æˆ‘ä»¬ä¼šé‡‡ç”¨ `C++` å’Œ `Python` åˆ†åˆ«å®ç°ï¼ŒäºŒè€…éƒ½éµå¾ªä¸Šè¿°å®ç°æµç¨‹ã€‚

::: note é™æ€å¹¿æ’­ä¸æ­¢ç¼–ç 

éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œ*é™æ€å¹¿æ’­å™¨* é™¤äº†å¯ä»¥ä»¥ç¼–ç çš„æ–¹å¼å®ç°å¤–ï¼Œåœ¨ `tf2` ä¸­è¿˜å†…ç½®äº†ç›¸å…³å·¥å…·ï¼Œå¯ä»¥**æ— éœ€ç¼–ç **ï¼Œ**ç›´æ¥æ‰§è¡Œ**èŠ‚ç‚¹å¹¶ä¼ å…¥è¡¨ç¤ºåæ ‡ç³»ç›¸å¯¹å…³ç³»çš„å‚æ•°ï¼Œå®ç°é™æ€åæ ‡ç³»å…³ç³»çš„å‘å¸ƒã€‚å¯¹äºé™æ€å¹¿æ’­è€Œè¨€ä¹Ÿæ¯”è¾ƒå»ºè®®ç›´æ¥ä½¿ç”¨è¯¥æ–¹æ³•ã€‚

è€Œ*åŠ¨æ€å¹¿æ’­å™¨* æ²¡æœ‰æä¾›ç±»ä¼¼çš„å·¥å…·ã€‚

:::

## å‡†å¤‡å·¥ä½œ

ç»ˆç«¯ä¸‹è¿›å…¥å·¥ä½œç©ºé—´çš„srcç›®å½•ï¼Œè°ƒç”¨å¦‚ä¸‹ä¸¤æ¡å‘½ä»¤åˆ†åˆ«åˆ›å»ºC++åŠŸèƒ½åŒ…å’ŒPythonåŠŸèƒ½åŒ…ã€‚

```bash
ros2 pkg create cpp03_tf_broadcaster --build-type ament_cmake --dependencies rclcpp tf2 tf2_ros geometry_msgs turtlesim
ros2 pkg create py03_tf_broadcaster --build-type ament_python --dependencies rclpy tf_transformations tf2_ros geometry_msgs turtlesim
```

## é™æ€å¹¿æ’­

### 1. ä½¿ç”¨å‘½ä»¤æ–¹å¼

åœ¨ tf2_rosåŠŸèƒ½åŒ…ä¸­æä¾›äº†ä¸€ä¸ªåä¸ºstatic_transform_publisherçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé€šè¿‡è¯¥æ–‡ä»¶å¯ä»¥ç›´æ¥å¹¿æ’­é™æ€åæ ‡ç³»å…³ç³»ï¼Œå…¶ä½¿ç”¨è¯­æ³•å¦‚ä¸‹ã€‚

::: tabs#grammer

@tab:active æ ¼å¼1#grammer1

ä½¿ç”¨ä»¥**ç±³**ä¸ºå•ä½çš„ `x/y/z` åç§»é‡å’Œä»¥**å¼§åº¦**ä¸ºå•ä½çš„`roll/pitch/yaw`ï¼ˆå¯ç›´è¯‘ä¸ºæ»šåŠ¨/ä¿¯ä»°/åèˆªï¼Œåˆ†åˆ«æŒ‡çš„æ˜¯å›´ç»• x/y/z è½´çš„æ—‹è½¬ï¼‰å‘ tf2 å‘å¸ƒé™æ€åæ ‡å˜æ¢ã€‚

```bash
ros2 run tf2_ros static_transform_publisher --x x --y y --z z --yaw yaw --pitch pitch --roll roll --frame-id frame_id --child-frame-id child_frame_id
```

ä¾‹å¦‚ä½¿ç”¨ï¼š

```bash
ros2 run tf2_ros static_transform_publisher --frame-id base_link --child-frame-id laser --x 1.0
```

åˆ™ä¼šåˆ›å»ºä¸¤ä¸ªåæ ‡ç³»:

![Rviz2ä¸­æ˜¾ç¤ºå‡ºä¸¤ä¸ªåæ ‡ç³»ï¼Œä¸€ä¸ªæ˜¯çˆ¶çº§åæ ‡ç³»base_linkï¼Œä¸€ä¸ªæ˜¯å­é›†åæ ‡ç³»laser](./assets/2026-01-29_002.jpg "çˆ¶çº§åæ ‡ç³»base_linkä¸å­é›†åæ ‡ç³»laseråœ¨xè½´æ­£æ–¹å‘ä¸Šåç§»1.0ç±³")

@tab:active æ ¼å¼2#grammer2

ä½¿ç”¨ä»¥**ç±³**ä¸ºå•ä½çš„ `x/y/z` åç§»é‡å’Œ `qx/qy/qz/qw` å››å…ƒæ•°å‘ tf2 å‘å¸ƒé™æ€åæ ‡å˜æ¢ã€‚

```bash
ros2 run tf2_ros static_transform_publisher --x x --y y --z z --qx qx --qy qy --qz qz --qw qw --frame-id frame_id --child-frame-id child_frame_id
```

ä¾‹å¦‚ä½¿ç”¨ï¼š

```bash
ros2 run tf2_ros static_transform_publisher --frame-id base_link --child-frame-id laser --x 1.0 --qz -0.247404 --qw 0.968912
```

åˆ™ä¼šåˆ›å»ºä¸¤ä¸ªåæ ‡ç³»:

![Rviz2ä¸­æ˜¾ç¤ºå‡ºä¸¤ä¸ªåæ ‡ç³»ï¼Œä¸€ä¸ªæ˜¯çˆ¶çº§åæ ‡ç³»base_linkï¼Œä¸€ä¸ªæ˜¯å­é›†åæ ‡ç³»laser](./assets/2026-01-29_004.jpg "çˆ¶çº§åæ ‡ç³»base_linkä¸å­é›†åæ ‡ç³»laseråœ¨xè½´æ­£æ–¹å‘ä¸Šåç§»1.0ç±³ï¼Œä¸”ä»¥zè½´ä¸ºæ—‹è½¬ç‚¹æ—‹è½¬äº†-0.5rad")

:::

::: note

â‘  åœ¨çˆ¶å­åæ ‡ç³»æœ‰åç§»å…³ç³»æ—¶ï¼Œä¸€èˆ¬ä¼š**ç”Ÿæˆä¸€ä¸ªç®­å¤´**ï¼Œç”±å­çº§åæ ‡ç³»åŸç‚¹æŒ‡å‘çˆ¶çº§åæ ‡ç³»åŸç‚¹ã€‚å…¶ä¸­ç”Ÿæˆçš„ç®­å¤´ä¸ºé»„è‰²ç®­ä½“ï¼Œç²‰è‰²ç®­å¤´ã€‚

![ç”Ÿæˆçš„ç®­å¤´ä¸ºé»„è‰²ç®­ä½“ï¼Œç²‰è‰²ç®­å¤´](./assets/2026-01-29_003.jpg "ç”Ÿæˆçš„ç®­å¤´ä¸ºé»„è‰²ç®­ä½“ï¼Œç²‰è‰²ç®­å¤´")

â‘¡ åœ¨ä¸Šè¿°ä¸¤ç§æ ¼å¼ä¸­é™¤äº†ç”¨äºè¡¨ç¤ºçˆ¶çº§åæ ‡ç³»çš„--frame-idå’Œç”¨äºè¡¨ç¤ºå­çº§åæ ‡ç³»çš„--child-frame-idä¹‹å¤–ï¼Œå…¶ä»–å‚æ•°éƒ½æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæœªæŒ‡å®šç‰¹å®šé€‰é¡¹ï¼Œé‚£ä¹ˆå°†**ç›´æ¥ä½¿ç”¨é»˜è®¤å€¼**ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾é™¤ `id` ä¹‹å¤–å…¶ä»–å‚æ•°éƒ½ä½¿ç”¨é»˜è®¤å€¼ï¼Œ

```bash
ros2 run tf2_ros static_transform_publisher --frame-id base_link --child-frame-id laser
```

åˆ™ä¼šåˆ›å»ºä¸¤ä¸ªåŸç‚¹å’Œè½´éƒ½é‡å çš„åæ ‡ç³»:

![Rviz2ä¸­æ˜¾ç¤ºå‡ºä¸¤ä¸ªåŸç‚¹å’Œè½´éƒ½é‡å çš„åæ ‡ç³»ï¼Œä¸€ä¸ªæ˜¯çˆ¶çº§åæ ‡ç³»base_linkï¼Œä¸€ä¸ªæ˜¯å­é›†åæ ‡ç³»laser](./assets/2026-01-29_001.jpg "çˆ¶çº§åæ ‡ç³»base_linkä¸å­é›†åæ ‡ç³»laser") {id="ref-keypoint"}

â‘¢ **å¦‚ä½•ä½¿ç”¨ Rviz2 æŸ¥çœ‹åæ ‡ç³»å…³ç³»?** ğŸ‘ˆ

æ–°å»ºç»ˆç«¯ï¼Œé€šè¿‡å‘½ä»¤ `rviz2` æ‰“å¼€ Rviz2 å¹¶é…ç½®ç›¸å…³æ’ä»¶æŸ¥çœ‹åæ ‡å˜æ¢æ¶ˆæ¯ï¼š

- å°† `Global Options` ä¸­çš„ `Fixed Frame` è®¾ç½®ä¸º `base_link`ï¼›
- ç‚¹å‡» `add` æŒ‰é’®æ·»åŠ  `TF` æ’ä»¶ï¼›
- å‹¾é€‰ `TF` æ’ä»¶ä¸­çš„ `show names`ã€‚

ä¹‹åå³ä¾§çš„ `Grid` çª—å£ä¸­å°†ä»¥å›¾å½¢åŒ–çš„æ–¹å¼æ˜¾ç¤ºåæ ‡å˜æ¢å…³ç³»ã€‚

![Rviz2ä¸­ä»¥å›¾å½¢åŒ–çš„æ–¹å¼æ˜¾ç¤ºåæ ‡å˜æ¢å…³ç³»](./assets/2026-01-29_007.jpg)
:::

åœ¨æ­¤åŸºäº `æ¡ˆä¾‹1`ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤å®ç°ï¼š

```bash
ros2 run tf2_ros static_transform_publisher --frame-id base_link --child-frame-id laser --x 0.4 --y 0.0 --z 0.2
ros2 run tf2_ros static_transform_publisher --frame-id base_link --child-frame-id camera --x -0.5 --y 0.0 --z 0.4
```

å¦‚ä¸‹å›¾ï¼š

![ä¸‰ä¸ªç‹¬ç«‹ç»ˆç«¯](./assets/2026-01-29_005.jpg "ä¸Šé¢ä¸ºä¸¤ä¸ªé™æ€åæ ‡å¹¿æ’­ç”¨ç»ˆç«¯çª—å£ï¼Œä¸‹é¢æ˜¯å¼€å¯Rviz2çš„ç»ˆç«¯çª—å£")

åˆ™ä¼šåˆ›å»ºå¦‚ä¸‹ä¸‰ä¸ªåæ ‡ç³»ï¼š

![RVIZ2çš„çª—å£ï¼Œå…¶ä¸­æœ‰ä¸‰ä¸ªåæ ‡ç³»](./assets/2026-01-29_006.jpg)

### 2. ä½¿ç”¨ç¼–ç æ–¹å¼

#### â… .ç¼–å†™å¹¿æ’­å®ç°åŸæ–‡ä»¶

::: tabs#CP

@tab:active C++

åŠŸèƒ½åŒ… `cpp03_tf_broadcaster` çš„ `src` ç›®å½•ä¸‹ï¼Œæ–°å»º `C++` æ–‡ä»¶ `demo01_static_tf_broadcaster.cpp`ï¼Œå¹¶ç¼–è¾‘æ–‡ä»¶ï¼Œè¾“å…¥å¦‚ä¸‹å†…å®¹ï¼š

```cpp
/*  
  éœ€æ±‚ï¼šç¼–å†™é™æ€åæ ‡å˜æ¢å¹¿æ’­å™¨ï¼Œæ‰§è¡Œè¯¥ç¨‹åºæ—¶éœ€ä¼ å…¥ä¸¤ä¸ªåæ ‡ç³»çš„ç›¸å¯¹ä½å§¿å…³ç³»ä»¥åŠçˆ¶å­çº§åæ ‡ç³»idï¼Œ
       ros2 run åŒ… å¯æ‰§è¡Œç¨‹åº x y z roll pitch yaw frame_id child_frame_id
  æ­¥éª¤ï¼š
    1.åŒ…å«å¤´æ–‡ä»¶ï¼›
    2.åˆ¤æ–­ç»ˆç«¯ä¼ å…¥çš„å‚æ•°æ˜¯å¦åˆæ³•ï¼›
    3.åˆå§‹åŒ– ROS å®¢æˆ·ç«¯ï¼›
    4.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›
      4-1.åˆ›å»ºé™æ€åæ ‡å˜æ¢å¹¿æ’­å¯¹è±¡ï¼›
      4-2.ä»ä¼ å…¥å‚æ•°ä¸­ç»„ç»‡å¹¶å‘å¸ƒæ¶ˆæ¯ã€‚
    5.è°ƒç”¨ spin å‡½æ•°ï¼Œå¹¶ä¼ å…¥å¯¹è±¡æŒ‡é’ˆï¼›
    6.é‡Šæ”¾èµ„æºã€‚

*/

// 1.åŒ…å«å¤´æ–‡ä»¶ï¼›
#include <geometry_msgs/msg/transform_stamped.hpp>

#include <rclcpp/rclcpp.hpp>
// å››å…ƒæ•°è½¬æ¢ç”¨çš„åº“
#include <tf2/LinearMath/Quaternion.h>
#include <tf2_ros/static_transform_broadcaster.h>

using std::placeholders::_1;

// 4.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›
class TFStaticBroadcaster : public rclcpp::Node
{
public:
  explicit TFStaticBroadcaster(char * transformation[]): Node("tf_static_broadcaster_node_cpp")
  {
    // 4-1.åˆ›å»ºé™æ€åæ ‡å˜æ¢å‘å¸ƒæ–¹ï¼›
    tf_publisher_ = std::make_shared<tf2_ros::StaticTransformBroadcaster>(this);
    // 4-2.ç»„ç»‡å¹¶å‘å¸ƒæ¶ˆæ¯ã€‚ï¼ˆè¿™è¾¹æ¨èå¦åˆ›å»ºä¸€å‡½æ•°ï¼‰
    this->make_transforms(transformation);
  }

private:
  // 4-2.ç»„ç»‡å¹¶å‘å¸ƒæ¶ˆæ¯ã€‚
  void make_transforms(char * transformation[])
  {
    // ç»„ç»‡æ¶ˆæ¯
    geometry_msgs::msg::TransformStamped t;

    t.header.stamp = this->now(); // æ—¶é—´æˆ³
    t.header.frame_id = transformation[7]; // çˆ¶çº§åæ ‡ç³»
    t.child_frame_id = transformation[8]; // å­çº§åæ ‡ç³»

    t.transform.translation.x = atof(transformation[1]);
    t.transform.translation.y = atof(transformation[2]);
    t.transform.translation.z = atof(transformation[3]);

    // åˆ›å»ºå››å…ƒæ•°å¯¹è±¡
    tf2::Quaternion q;
    q.setRPY(
      atof(transformation[4]),
      atof(transformation[5]),
      atof(transformation[6]));
    t.transform.rotation.x = q.x();
    t.transform.rotation.y = q.y();
    t.transform.rotation.z = q.z();
    t.transform.rotation.w = q.w();

    // å‘å¸ƒæ¶ˆæ¯
    tf_publisher_->sendTransform(t);
    RCLCPP_INFO(get_logger(), "å·²æˆåŠŸå‘å¸ƒå¹¿æ’­ï¼");
  }
  std::shared_ptr<tf2_ros::StaticTransformBroadcaster> tf_publisher_;
};

int main(int argc, char * argv[])
{
  // 2.åˆ¤æ–­ç»ˆç«¯ä¼ å…¥çš„å‚æ•°æ˜¯å¦åˆæ³•ï¼›
  auto logger = rclcpp::get_logger("logger");

  if (argc != 9) {
    RCLCPP_INFO(
      logger, "è¿è¡Œç¨‹åºæ—¶è¯·æŒ‰ç…§ï¼šx y z roll pitch yaw frame_id child_frame_id çš„æ ¼å¼ä¼ å…¥å‚æ•°");
    return 1;
  }

  // 3.åˆå§‹åŒ– ROS å®¢æˆ·ç«¯ï¼›
  rclcpp::init(argc, argv);
  // 5.è°ƒç”¨ spin å‡½æ•°ï¼Œå¹¶ä¼ å…¥å¯¹è±¡æŒ‡é’ˆï¼›
  rclcpp::spin(std::make_shared<TFStaticBroadcaster>(argv));
  // 6.é‡Šæ”¾èµ„æºã€‚
  rclcpp::shutdown();
  return 0;
}
```

æ³¨ï¼šåœ¨ä»¥ä¸Šä»£ç ä¸­ï¼š

```cpp
...
public:
  explicit TFStaticBroadcaster(char * transformation[]): Node("tf_static_broadcaster_node_cpp")
  ...
```

è¿™é‡Œçš„ `explicit` ç”¨äºä¿®é¥°ç±»çš„æ„é€ å‡½æ•°ï¼Œå®ƒå¯ä»¥**ç¦æ­¢**ç¼–è¯‘å™¨å¯¹è¢«ä¿®é¥°çš„æ„é€ å‡½æ•°æ‰§è¡Œ **éšå¼ç±»å‹è½¬æ¢ / éšå¼æ„é€ ** è¡Œä¸ºã€‚

@tab Python

åŠŸèƒ½åŒ… py03_tf_broadcaster çš„ py03_tf_broadcaster ç›®å½•ä¸‹ï¼Œæ–°å»º Python æ–‡ä»¶ demo01_static_tf_broadcaster_py.pyï¼Œå¹¶ç¼–è¾‘æ–‡ä»¶ï¼Œè¾“å…¥å¦‚ä¸‹å†…å®¹ï¼š

```python
"""  
    éœ€æ±‚ï¼šç¼–å†™é™æ€åæ ‡å˜æ¢å¹¿æ’­å™¨ï¼Œæ‰§è¡Œè¯¥ç¨‹åºæ—¶éœ€ä¼ å…¥ä¸¤ä¸ªåæ ‡ç³»çš„ç›¸å¯¹ä½å§¿å…³ç³»ä»¥åŠçˆ¶å­çº§åæ ‡ç³»idï¼Œ
       ros2 run åŒ… å¯æ‰§è¡Œç¨‹åº x y z roll pitch yaw frame_id child_frame_id
    æ­¥éª¤ï¼š
        1.å¯¼åŒ…ï¼›
        2.åˆ¤æ–­ç»ˆç«¯ä¼ å…¥çš„å‚æ•°æ˜¯å¦åˆæ³•ï¼›
        3.åˆå§‹åŒ– ROS å®¢æˆ·ç«¯ï¼›
        4.å®šä¹‰èŠ‚ç‚¹ç±»ï¼›
            4-1.åˆ›å»ºé™æ€åæ ‡å˜æ¢å¹¿æ’­å¯¹è±¡ï¼›
            4-2.ä»ä¼ å…¥å‚æ•°ä¸­ç»„ç»‡å¹¶å‘å¸ƒæ¶ˆæ¯ã€‚
        5.è°ƒç”¨ spin å‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡ï¼›
        6.é‡Šæ”¾èµ„æºã€‚

"""
# 1.å¯¼åŒ…ï¼›
import rclpy
from rclpy.node import Node
import sys
from rclpy.logging import get_logger
from tf2_ros.static_transform_broadcaster import StaticTransformBroadcaster
from geometry_msgs.msg import TransformStamped
from geometry_msgs.msg import Quaternion
import tf_transformations

# 4.è‡ªå®šä¹‰èŠ‚ç‚¹ç±»ï¼›
class TFStaticBroadcasterPy(Node):
    def __init__(self, argv):
        super().__init__("tf_static_broadcaster_py_node_py")
        # 4-1.åˆ›å»ºé™æ€åæ ‡å˜æ¢å¹¿æ’­å¯¹è±¡ï¼›
        self.broadcaster = StaticTransformBroadcaster(self)
        # 4-2.ä»ä¼ å…¥å‚æ•°ä¸­ç»„ç»‡å¹¶å‘å¸ƒæ¶ˆæ¯ã€‚
        self.make_transforms(argv)

    def make_transforms(self, argv):

        t = TransformStamped()
        # ç»„ç»‡æ¶ˆæ¯
        t.header.stamp = self.get_clock().now().to_msg() # è®¾ç½®æ—¶é—´æˆ³
        t.header.frame_id = argv[7]
        t.child_frame_id = argv[8]

        t.transform.translation.x = float(argv[1])
        t.transform.translation.y = float(argv[2])
        t.transform.translation.z = float(argv[3])

        # è®¾ç½®å››å…ƒæ•°
        q = tf_transformations.quaternion_from_euler(float(argv[4]),float(argv[5]),float(argv[6]))
        t.transform.rotation.x = q[0]
        t.transform.rotation.y = q[1]
        t.transform.rotation.z = q[2]
        t.transform.rotation.w = q[3]

        self.broadcaster.sendTransform(t)

        self.get_logger().info("å·²æˆåŠŸå‘å¸ƒå¹¿æ’­ï¼")

def main():
    # 2. åˆ¤æ–­ç»ˆç«¯ä¼ å…¥çš„å‚æ•°æ˜¯å¦åˆæ³•ï¼›
    if len(sys.argv) != 9:
        get_logger("rclpy").error("è¿è¡Œç¨‹åºæ—¶è¯·æŒ‰ç…§ï¼šx y z roll pitch yaw frame_id child_frame_id çš„æ ¼å¼ä¼ å…¥å‚æ•°")
        return
    # 3.åˆå§‹åŒ–ROS2å®¢æˆ·ç«¯ï¼›
    rclpy.init()
    # 5.è°ƒç”¨spainå‡½æ•°ï¼Œå¹¶ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡ï¼›
    rclpy.spin(TFStaticBroadcasterPy(sys.argv))
    # 6.èµ„æºé‡Šæ”¾ã€‚ 
    rclpy.shutdown()

if __name__ == '__main__':
    main()
```

æ³¨ï¼š
> è¿™é‡Œçš„ `import tf_transformations` ä¸ºä½¿ç”¨äº† `sudo apt install ros-jazzy-tf-transformations` æ‰€å®‰è£…çš„ä¾èµ–åŒ…å®ç°æ¬§æ‹‰è§’å’Œå››å…ƒæ•°ä¹‹é—´çš„ç›¸äº’è½¬æ¢ã€‚è¯¥ä¾èµ–åŒ…é€šå¸¸é€‚ç”¨äºå°† `ROS` çš„ä»£ç ç§»æ¤åˆ° `ROS2` ä¸Šæ—¶ä½¿ç”¨ã€‚
> å¦‚æœæ˜¯ç›´æ¥ä½¿ç”¨ ROS2 è¿›è¡Œé¡¹ç›®å¼€å‘ï¼Œå®é™…ä¸Šæ›´æ¨èä½¿ç”¨ `transforms3d` åº“ä»¥å®ç°æ¬§æ‹‰è§’å’Œå››å…ƒæ•°ä¹‹é—´çš„ç›¸äº’è½¬æ¢ã€‚åœ¨å®˜æ–¹æ•™ç¨‹ä¸­ï¼Œå…¶ç”šè‡³æ˜¯ä½¿ç”¨çš„è‡ªå®šä¹‰å‡½æ•°ã€‚

:::

#### â…¡.ç¼–è¾‘é…ç½®æ–‡ä»¶

::: tabs#CP

@tab:active C++

åœ¨ `CMakeLists.txt` ä¸­å‘å¸ƒå’Œè®¢é˜…ç¨‹åºæ ¸å¿ƒé…ç½®å¦‚ä¸‹ï¼š

```txt
find_package(ament_cmake REQUIRED)
find_package(rclcpp REQUIRED)
find_package(tf2 REQUIRED)
find_package(tf2_ros REQUIRED)
find_package(geometry_msgs REQUIRED)
find_package(turtlesim REQUIRED)

add_executable(demo01_static_tf_broadcaster src/demo01_static_tf_broadcaster.cpp)
ament_target_dependencies(
  demo01_static_tf_broadcaster
  "rclcpp"
  "tf2"
  "tf2_ros"
  "geometry_msgs"
  "turtlesim"
)

install(TARGETS demo01_static_tf_broadcaster
  DESTINATION lib/${PROJECT_NAME})
```

@tab Python

åœ¨ `setup.py` ä¸­é’ˆå¯¹ `entry_points` å­—æ®µçš„ `console_scripts` æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š

```python
...
entry_points={
    'console_scripts': [
        'demo01_static_tf_broadcaster_py = py03_tf_broadcaster.demo01_static_tf_broadcaster_py:main'
    ],
},
...
```

:::

#### â…¢.ç¼–è¯‘

ç»ˆç«¯ä¸­è¿›å…¥å½“å‰å·¥ä½œç©ºé—´ï¼Œç¼–è¯‘åŠŸèƒ½åŒ…ï¼š

::: tabs#CP

@tab:active C++

```bash
colcon build --packages-select cpp03_tf_broadcaster
```

@tab Python

```bash
colcon build --packages-select py03_tf_broadcaster
```

:::

#### â…£.è¿è¡Œ

å½“å‰å·¥ä½œç©ºé—´ä¸‹ï¼Œå¯åŠ¨ä¸¤ä¸ªç»ˆç«¯ï¼Œç»ˆç«¯1è¾“å…¥å¦‚ä¸‹å‘½ä»¤å‘å¸ƒé›·è¾¾ï¼ˆlaserï¼‰ç›¸å¯¹äºåº•ç›˜ï¼ˆbase_linkï¼‰çš„é™æ€åæ ‡å˜æ¢ï¼š

::: tabs#CP

@tab:active C++

```bash
. install/setup.bash 
ros2 run cpp03_tf_broadcaster demo01_static_tf_broadcaster 0.4 0 0.2 0 0 0 base_link laser
```

ç»ˆç«¯2è¾“å…¥å¦‚ä¸‹å‘½ä»¤å‘å¸ƒæ‘„åƒå¤´ï¼ˆcameraï¼‰ç›¸å¯¹äºåº•ç›˜ï¼ˆbase_linkï¼‰çš„é™æ€åæ ‡å˜æ¢ï¼š

```bash
. install/setup.bash
ros2 run cpp03_tf_broadcaster demo01_static_tf_broadcaster -0.5 0 0.4 0 0 0 base_link camera
```

æ­¤æ—¶å°±å¯ä»¥çœ‹åˆ°ï¼š

![è¾“å…¥é”™è¯¯å‚æ•°ä¸è¾“å…¥æ­£ç¡®å‚æ•°æ‰€å¾—åˆ°çš„logäº¦ä¸åŒ](./assets/2026-01-29_008.jpg "æ–‡ä»¶åæœ‰å•è¯æ‹¼é”™äº†ï¼Œæ‰€ä»¥å†™çš„æ˜¯â€œststicâ€...")

@tab Python

```bash
. install/setup.bash 
ros2 run py03_tf_broadcaster demo01_static_tf_broadcaster_py  0.4 0 0.2 0 0 0 base_link laser
```

ç»ˆç«¯2è¾“å…¥å¦‚ä¸‹å‘½ä»¤å‘å¸ƒæ‘„åƒå¤´ï¼ˆcameraï¼‰ç›¸å¯¹äºåº•ç›˜ï¼ˆbase_linkï¼‰çš„é™æ€åæ ‡å˜æ¢ï¼š

```bash
. install/setup.bash
ros2 run cpp03_tf_broadcaster demo01_static_tf_broadcaster_py  -0.5 0 0.4 0 0 0 base_link camera
```

æ­¤æ—¶å°±å¯ä»¥çœ‹åˆ°ï¼š

![ä½¿ç”¨pythonå¹¿æ’­é™æ€åæ ‡ç³»](./assets/2026-01-30_002.jpg "æ–‡ä»¶åçš„å•è¯å†™åäº†ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ˜¯â€œ_tf_staticâ€...")

:::

#### â…¤.åœ¨ Rviz2 ä¸­æŸ¥çœ‹åæ ‡ç³»å…³ç³»

ä½ å¯ä»¥å‚è€ƒ [å‰æ–‡æ³¨é‡Š](./2026_01_29.md#ref-keypoint) ä¸­çš„ç›¸å…³å†…å®¹ä»¥æ‰“å¼€ `Rviz2`ã€‚

![æ‰“å¼€ Rviz2 åå¦‚å›¾æ‰€ç¤º](./assets/2026-01-29_009.jpg "C++ ä¸ Python çš„ç»“æœç›¸åŒï¼Œæ‰€ä»¥ç”¨åŒä¸€å¼ å›¾ç‰‡äº†XD")

::: tip æ‰€ä»¥ï¼Œä¸ç”¨è‡ªå·±åšè¯é¢˜çš„å‘å¸ƒå—?
è™½ç„¶å’±ä¹‹å‰æåˆ°è¿‡è¯´ï¼Œâ€œåæ ‡å˜æ¢åº•å±‚ä¸Šå°±æ˜¯è¯é¢˜é€šä¿¡â€ï¼Œä½†æ˜¯åœ¨ä¹¦å†™åæ ‡å˜æ¢æ—¶ï¼Œæˆ‘ä»¬ **ä¸éœ€è¦è‡ªå·±å‘å¸ƒè¯é¢˜**ï¼Œå…¶åœ¨æºç ä¸Šä¼šå¸®æˆ‘ä»¬è‡ªå·±ç”Ÿæˆã€‚
ä»–çš„é»˜è®¤å€¼ä¸º `/tf_static`ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥çœ‹ `tf2_ros::StaticTransformBroadcaster` æˆ–è€… `tf2_ros.static_transform_broadcaster` çš„æºç ä»¥éªŒè¯ï¼š

![tf2_ros::StaticTransformBroadcasterçš„æºç ](./assets/2026-01-30_001.jpg "ä»¥C++ä¸ºä¾‹")

:::

::: tip èŠ‚ç‚¹ä¹Ÿä¸ç”¨å—ï¼Ÿ
ç¡®å®ã€‚è™½ç„¶â€œæ— è®ºåˆ›å»ºä½•ç§é€šä¿¡å¯¹è±¡ï¼Œéƒ½éœ€è¦ä¾èµ–äºä¸€ä¸ªèŠ‚ç‚¹â€ï¼Œä½†æ˜¯ä»¥ `c++` ä¸ºä¾‹å­ï¼š

```cpp
...
    // 4-1.åˆ›å»ºé™æ€åæ ‡å˜æ¢å‘å¸ƒæ–¹ï¼›
    tf_publisher_ = std::make_shared<tf2_ros::StaticTransformBroadcaster>(this);

```

è¿™é‡Œåªéœ€è¦ä¼ å…¥å½“å‰å¯¹è±¡ `this` å³å¯ã€‚

:::

## åŠ¨æ€å¹¿æ’­

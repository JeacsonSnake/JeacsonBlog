---
title: ROS2-017-ROS2å·¥å…·ï¼šå¯åŠ¨æ–‡ä»¶ launch çš„pythonå®ç°
icon: 'kitchen-set'
date: 2025-04-29
category:
  - Computer
  - robot
  - ROS
---

## ç®€ä»‹

æœ‰å…³ launch æ–‡ä»¶çš„ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒ[ä¸Šä¸€ç¯‡å†…å®¹](./2025_04_28.md#ç®€ä»‹)

## å£¹ã€Python å®ç°è¯­æ³•

ä»¥ä¸‹ä»‹ç»åœ¨ Python ä¸­ **launch æ–‡ä»¶** çš„ç›¸å…³è¯­æ³•ï¼š

### 1. èŠ‚ç‚¹è®¾ç½®-Node

åœ¨ **ä½¿ç”¨ Python å®ç°çš„ launch æ–‡ä»¶** ä¸­ï¼Œè¢«æ‰§è¡Œçš„èŠ‚ç‚¹éœ€è¦ç»Ÿä¸€å°è£…ä¸º `launch_ros.actions.Node` å¯¹è±¡ï¼Œå¹¶é€šè¿‡ `LaunchDescription()` å‡½æ•°åˆ›å»ºç‰¹å®šåŒ…è£…å¯¹è±¡ä»¥è¿›è¡Œè¿”å›ã€‚ä»¥ä¸‹å°†ä¼šé’ˆå¯¹ç»Ÿä¸€å°è£…çš„ `Node` å¯¹è±¡å†…çš„å‚æ•°è¿›è¡Œè¯´æ˜ã€‚

å‡è®¾è¯¥ launch æ–‡ä»¶çš„**æ–‡ä»¶å**ä¸ºâ€œpy02_node_launch.pyâ€ï¼Œæ‰€åœ¨**åŠŸèƒ½åŒ…å**ä¸º â€œpackage_for_launch_01â€ï¼Œè¯¥ launch æ–‡ä»¶å¯ä»¥ç¼–å†™ä¸ºå¦‚ä¸‹é…ç½®ï¼š

```python
# py02_node_launch.py
from launch import LaunchDescription
from launch_ros.actions import Node

# è·å–åŠŸèƒ½åŒ…ä¸‹ share ç›®å½•è·¯å¾„------
from ament_index_python.packages import get_package_share_directory
import os

def generate_launch_description():
    # èŠ‚ç‚¹é…ç½®ç¤ºä¾‹
    turtle1 = Node(

        # å¯æ‰§è¡Œç¨‹åº
        executable="turtlesim_node",

        # åŒ…å
        package="turtlesim",

        # è®¾ç½®èŠ‚ç‚¹æ˜¯å¦ä¼šè‡ªåŠ¨é‡å¯ (è¿™é‡Œè®¾ç½®ä¸ºTrue)
        respawn=True,

        # è¦†ç›–èŠ‚ç‚¹åç§°
        name="t1",

        # è®¾ç½®å‘½åç©ºé—´
        namespace="/robot1",

        # è¿›ç¨‹æ˜¾ç¤ºåç§°ï¼ˆåœ¨ps/topä¸­å¯è§ï¼‰
        exec_name="turtle_sim",
        
        # å‚æ•°é…ç½®
        parameters=[
            {"background_r": 255, "background_g": 0, "background_b": 0},  # å­—å…¸ä¼ å‚
            os.path.join(get_package_share_directory("package_for_launch_01"), "config", "custom_params.yaml" ) # YAMLæ–‡ä»¶ä¼ å‚ (å¸¸ç”¨ï¼Œå»ºè®®é‡‡ç”¨)
        ],
         
        # é‡æ˜ å°„é…ç½®
        remappings=[
            ("/turtle1/cmd_vel", "/robot1/cmd_vel"),  # è¯é¢˜é‡æ˜ å°„
            ("/turtle1/pose", "/robot1/pose")
        ],
        
        # ROSä¸“ç”¨å‚æ•°
        ros_arguments=[
            "--log-level", "debug",  # è®¾ç½®æ—¥å¿—çº§åˆ«
            "--ros-args", "-p", "use_sim_time:=true"  # è¦†ç›–å‚æ•°ï¼ˆéœ€æ˜¾å¼æ·»åŠ --ros-argsï¼‰
        ],
        
        # æ™®é€šå‘½ä»¤è¡Œå‚æ•°
        arguments=[
            "--custom-flag",  # è‡ªå®šä¹‰æ ‡å¿—
            "--config", "/path/to/non_ros_config.json"
        ]
    )
    
    return LaunchDescription([turtle1])

```

å…¶ä¸­ï¼š

- executableï¼šå¯æ‰§è¡Œç¨‹åº
- packageï¼šè¢«æ‰§è¡Œç¨‹åºæ‰€å±åŠŸèƒ½åŒ…çš„åç§°
- respawnï¼šè®¾ç½®èŠ‚ç‚¹æ˜¯å¦ä¼šè‡ªåŠ¨é‡å¯ (é’ˆå¯¹ç‰¹æ®ŠèŠ‚ç‚¹ï¼Œå¦‚éœ€è¦åœ¨å‡ºç°å¼‚å¸¸è¢«å…³é—­ä¹‹åè‡ªåŠ¨é‡å¯çš„èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨)
- nameï¼šè®¾ç½®èŠ‚ç‚¹åç§°ï¼Œå¯ä»¥ç”¨äºè§£å†³é‡åé—®é¢˜
- namespaceï¼šè®¾ç½®å‘½åç©ºé—´ï¼Œå¯ä»¥ç”¨äºè§£å†³é‡åé—®é¢˜
- exec_nameï¼šè®¾ç½®ç¨‹åºè¿è¡Œæ—¶å‘½ä»¤è¡Œå·¦ä¾§æ‰€æ˜¾ç¤ºçš„å¯¹åº”æ ‡ç­¾
- remappingsï¼šç”¨äºå®ç°è¯é¢˜é‡æ˜ å°„
- parameters
- ros_arguments
- arguments

::: info "parameters"/"ros_arguments"/"arguments"ä¹‹é—´çš„åŒºåˆ«
åœ¨ä¸Šè¿°åˆ›å»º `Node` å¯¹è±¡çš„åˆå§‹å‡½æ•°ä¸­ï¼Œæœ‰ä»¥ä¸‹ä¸‰ä¸ªåç§°ä¸­åŒ…å«â€œå‚æ•°â€æ„æ€çš„å‚æ•°ï¼Œå®ƒä»¬çš„æ„æ€åˆ†åˆ«ä¸ºï¼š

- **parameters**ï¼šèŠ‚ç‚¹åœ¨è¿è¡Œæ—¶ï¼Œ**å…¶è‡ªèº«**éœ€è¦è¯»å–çš„å‚æ•°ï¼Œå¯ä»¥ç†è§£ä¸ºç±»ä¼¼ç»™ **ä¸€èˆ¬è°ƒç”¨å‡½æ•°** æ‰€ä¼ å…¥çš„ â€œå‚æ•°â€
- **ros_arguments**ï¼šèŠ‚ç‚¹åœ¨è¿è¡Œæ—¶ï¼Œ**ROS2åº•å±‚ç³»ç»Ÿ** éœ€è¦è¯»å–çš„ ROS ä¸“ç”¨å‚æ•°ï¼ˆä¾‹å¦‚èŠ‚ç‚¹é‡å‘½åã€å‘½åç©ºé—´ã€å‚æ•°æ–‡ä»¶åŠ è½½ç­‰ï¼‰ã€‚
- **arguments**ï¼šèŠ‚ç‚¹åœ¨è¿è¡Œæ—¶ï¼Œ**å¯æ‰§è¡Œæ–‡ä»¶** éœ€è¦è¯»å–çš„ *ä¸ ROS æœ¬èº«æ— å…³* çš„æ™®é€šåº”ç”¨çº§å‘½ä»¤è¡Œå‚æ•°ï¼ˆä¾‹å¦‚è‡ªå®šä¹‰é…ç½®æ–‡ä»¶è·¯å¾„ã€è°ƒè¯•æ ‡å¿—ç­‰ï¼‰

å…·ä½“è€Œè¨€ï¼Œè¿™ä¸‰ä¸ªå‚æ•°å®é™…æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š

- parametersï¼š
  - **èŠ‚ç‚¹è‡ªèº«** éœ€è¦è¯»å–çš„å‚æ•°ï¼Œé€šå¸¸ç”¨äºç»™èŠ‚ç‚¹ä¼ å‚
  - å…¶æ”¯æŒç›´æ¥å®šä¹‰å­—å…¸ï¼ˆå¦‚ `{"key": value}`ï¼‰æˆ–æŒ‡å®š YAML/JSON æ–‡ä»¶è·¯å¾„è¿›è¡Œä¼ å‚ï¼ˆæ›´å¸¸ç”¨ï¼‰ï¼›
  - å…¶å¯é€šè¿‡åº•å±‚è‡ªåŠ¨ç”Ÿæˆ `--params-file` å‚æ•°å¹¶è§¦å‘ ROS ä¸­é—´ä»¶è§£æï¼›
  - å‚æ•°å¯é€šè¿‡ `ros2 param` å‘½ä»¤æˆ– ROS æœåŠ¡è¿›è¡ŒåŠ¨æ€ä¿®æ”¹ï¼Œä¸”å…¶æ”¯æŒç±»å‹æ¨æ–­ï¼ˆä¾‹å¦‚è‡ªåŠ¨è¯†åˆ«æ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²ç­‰ï¼‰ã€‚
- ros_argumentsï¼š
  - **ROS2åº•å±‚ç³»ç»Ÿ** éœ€è¦è¯»å–çš„ ROS ä¸“ç”¨å‚æ•°ï¼Œé€šå¸¸äº¦ç”¨äºè¦†ç›–åŸæœ¬ç»™èŠ‚ç‚¹çš„ä¼ å‚ä»¥è¿›è¡Œè°ƒè¯•
  - è‹¥åœ¨å‘½ä»¤è¡Œä¸­ç­‰æ•ˆæ‰§è¡Œï¼Œè¯¥å‚æ•°å†…ä¼ é€’å€¼ä¼šè¢«åŒ…è£…åœ¨ `--ros-args` æ ‡å¿—ä¹‹åï¼Œä½¿ ROS ä¸­é—´ä»¶å¯ä»¥å¼ºåˆ¶è§£æè¿™äº›å‚æ•°ï¼›
  - æ”¯æŒ ROS å‚æ•°è¯­æ³•ï¼ˆå¦‚ `--log-level`, `__ns`, `--remap` ç­‰ï¼‰ã€‚
- argumentsï¼š
  - **å¯æ‰§è¡Œæ–‡ä»¶** éœ€è¦è¯»å–çš„æ™®é€šåº”ç”¨çº§å‘½ä»¤è¡Œå‚æ•°ï¼Œä¸ ROS æœ¬èº«æ— å…³
  - å‚æ•°ä¼šè¢«ç›´æ¥è¿½åŠ åˆ°èŠ‚ç‚¹å‘½ä»¤è¡Œçš„æœ«å°¾ï¼›
  - ä¸ä¼šè§¦å‘ ROS å‚æ•°è§£æå™¨ï¼ˆ`rclcpp::init`ï¼‰çš„ç‰¹æ®Šå¤„ç†ã€‚

åˆ—æˆè¡¨æ ¼å³ä¸ºå¦‚ä¸‹åŒºåˆ«ï¼š

| ç‰¹æ€§                | parameters          | ros_arguments       | arguments           |
|---------------------|---------------------|---------------------|---------------------|
| **ä½œç”¨åŸŸ**          | èŠ‚ç‚¹è¿è¡Œæ—¶è‡ªç”¨å‚æ•°  | ROS2 åº•å±‚ç³»ç»Ÿå†… ROS ä¸­é—´ä»¶é…ç½®     | å¤–éƒ¨ç¯å¢ƒ-å¯æ‰§è¡Œæ–‡ä»¶ è¿›ç¨‹çº§å‘½ä»¤è¡Œå‚æ•°    |
| **ä¸€èˆ¬é…ç½®ç”¨é€”**    | èŠ‚ç‚¹è¿è¡Œæ—¶è‡ªç”¨ç®—æ³•å‚æ•°ã€æ§åˆ¶å‚æ•°ç­‰      | é‡æ˜ å°„è¯é¢˜ã€å‘½åç©ºé—´ã€æ—¥å¿—çº§åˆ«     | æŒ‡å®šé…ç½®æ–‡ä»¶ã€è°ƒè¯•æ¨¡å¼    |
| **åŠ¨æ€å¯ä¿®æ”¹æ€§**    | âœ… (é€šè¿‡ ROS æ¥å£)  | âŒ (å¯åŠ¨æ—¶å›ºå®š)     | âŒ (å¯åŠ¨æ—¶å›ºå®š)     |
| **å…¸å‹è¯­æ³•**        | `{"key": value}` æˆ– `params.yaml`    | `["--remap", "old:=new"]`  | `["--config", "my_config.txt"]`           |
| **åº•å±‚æ ‡å¿—**        | `--params-file`     | `--ros-args`        | æ— ç‰¹æ®Šæ ‡å¿—          |
| **ä¼˜å…ˆçº§è§„åˆ™**      | ä½äº `ros_arguments`| è¾ƒé«˜ï¼Œä½äºROSå‘½ä»¤è¡Œå‚æ•°                | ç‹¬ç«‹ä½œç”¨åŸŸ          |
| **å®é™…èŠ‚ç‚¹ä¼ å‚æ—¶ä¼˜å…ˆçº§**      | æ¨èå‘èŠ‚ç‚¹å†…å¯¼å…¥å‚æ•°æ•°æ®æ—¶æœ€å…ˆä½¿ç”¨ | ä»…åœ¨éœ€è¦è¦†ç›–å‚æ•°æ—¶ä½¿ç”¨         | æ— éœ€ä½¿ç”¨         |

å› æ­¤åœ¨å®è·µä¸­ï¼Œä¸€èˆ¬å»ºè®®ï¼š

1. **ä¼˜å…ˆä½¿ç”¨ `parameters`** ç®¡ç†èŠ‚ç‚¹è¿è¡Œæ—¶é…ç½®ï¼ˆç±»å‹å®‰å…¨ã€æ”¯æŒåŠ¨æ€è°ƒæ•´ï¼‰ï¼›
2. ä»…åœ¨ **éœ€è¦è¦†ç›–å‚æ•°æ—¶** ä½¿ç”¨ `ros_arguments`ï¼›
3. **é¿å…åœ¨ `arguments` ä¸­ä¼ é€’ ROS ç›¸å…³å‚æ•°**ï¼ˆæ˜“å¯¼è‡´è§£æå¤±è´¥ï¼‰ã€‚

:::

å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œå½“ä½¿ç”¨ `parameters` è¿›è¡Œä¼ å‚æ—¶ï¼Œå¦‚æœéœ€è¦ä¼ å…¥çš„å‚æ•°æ•°é‡è¿‡å¤šï¼Œåˆ™ä½¿ç”¨`{"key": value}`è¿›è¡Œçš„ä¼ å‚æ–¹å¼å°±ä¼šå˜å¾—ååˆ†ä¸å¦¥ã€‚

å› æ­¤åœ¨é’ˆå¯¹ä½¿ç”¨ `parameters` è¿›è¡Œä¼ å‚æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šä¼šæ›´ç»å¸¸ä½¿ç”¨ `yaml` æ–‡ä»¶è¿›è¡Œä¼ å‚ã€‚

ä¸ºäº†æ ¼å¼ç»Ÿä¸€ä¸ä»£ç ç¼–è¯‘æ—¶å…¶è‡ªèº«çš„å¯ç¼–è¯‘æ€§ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨ä»¥ä¸‹æ­¥éª¤åˆ›å»º**å¸¦ç‰¹å®šæ ¼å¼çš„** `yaml` æ–‡ä»¶ï¼š(å‡è®¾bashè·¯å¾„åœ¨å·¥ä½œç©ºé—´æ ¹ç›®å½•ä¸‹)

1. å…ˆå°†å‰æ–‡æ‰€è¿°èŠ‚ç‚¹å¯åŠ¨

    ```bash
    . install/setup.bash
    ros2 launch py01_launch py02_node_launch.py
    ```

2. åœ¨åŒä¸€ç›®å½•ä¸‹å¦å¼€ä¸€ç»ˆç«¯ï¼Œè¾“å…¥ï¼š

    ```bash
        ros2 param dump /robot1/t1 > src/package_for_launch_01/config/custom_params.yaml
    ```

    æ­¤æ—¶å°±ä¼šåœ¨å·¥ä½œç©ºé—´æ ¹ç›®å½•å†…çš„ `src/package_for_launch_01/config` è·¯å¾„ä¸‹ç”Ÿæˆä¸€ä¸ª `custom_params.yaml` æ–‡ä»¶äº†ï¼Œä½†æ˜¯è¿™ä¸ªYAMLæ–‡ä»¶è¿˜æ— æ³•ç›´æ¥ä½¿ç”¨ã€‚

3. æˆ‘ä»¬éœ€è¦åŒä¹‹å‰æ·»åŠ  `launch` æ–‡ä»¶ä¸€æ ·åœ¨ `CMakeLists.txt` ä¸­ `ğŸ‘ˆ` ä½ç½®æ·»åŠ ä»¥ä¸‹è¯­å¥ï¼š

    ```txt
    ......
    find_package(rclcpp REQUIRED)

    install(DIRECTORY launch config DESTINATION share/${PROJECT_NAME}) ğŸ‘ˆ

    if(BUILD_TESTING)
    ......
    ```

4. è¿›è¡Œç¼–è¯‘ï¼š

    ```bash
    colcon build --pakages-select package_for_launch_01
    ```

5. æœ€åé€šè¿‡å¯¼å…¥ `get_package_share_directory` å‡½æ•°åŠ¨æ€ä»¥è·å– `install` ç›®å½•å†… **è¯¥åŠŸèƒ½åŒ…åä¸‹** `share` æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼Œæœ€åä¸ `config` å’Œ `custom_params.yaml` ç›¸å…³çš„è·¯å¾„ä¿¡æ¯ç›¸æ‹¼æ¥å³å¯ï¼š

    ```python
        # è·å–åŠŸèƒ½åŒ…ä¸‹ share ç›®å½•è·¯å¾„------
        from ament_index_python.packages import get_package_share_directory
        import os
        ...

        # å‚æ•°é…ç½®æ—¶åŠ¨æ€è·å–è·¯å¾„
        parameters=[
            os.path.join(get_package_share_directory("package_for_launch_01"), "config", "custom_params.yaml" ) # YAMLæ–‡ä»¶ä¼ å‚ (å¸¸ç”¨ï¼Œå»ºè®®é‡‡ç”¨)
        ],
    ```

### 2. æ‰§è¡ŒæŒ‡ä»¤è®¾ç½®-ExecuteProcess

åœ¨ **ä½¿ç”¨ Python å®ç°çš„ launch æ–‡ä»¶** ä¸­ï¼Œä¸ºäº†é’ˆå¯¹ ROS2 å‘½ä»¤ç­‰å¤–éƒ¨è¿›ç¨‹è¿›è¡Œå°è£…ï¼Œä»¥å®ç°éƒ¨ä»½åŠŸèƒ½çš„ç®€åŒ–è°ƒç”¨æ‰§è¡Œï¼Œéœ€è¦ä½¿ç”¨è¢«ç»Ÿä¸€å°è£…ä¸º `launch.actions.ExecuteProcess` çš„å¯¹è±¡ï¼Œå¹¶é€šè¿‡ `LaunchDescription()` å‡½æ•°åˆ›å»ºç‰¹å®šåŒ…è£…å¯¹è±¡ä»¥è¿›è¡Œè¿”å›ã€‚

ä»¥ä¸‹å°†ä¼šé’ˆå¯¹ç»Ÿä¸€å°è£…çš„ `ExecuteProcess` å¯¹è±¡å†…çš„å‚æ•°è¿›è¡Œè¯´æ˜ã€‚

å‡è®¾è¯¥ launch æ–‡ä»¶çš„**æ–‡ä»¶å**ä¸ºâ€œpy03_cmd_launch.pyâ€ï¼Œæ‰€åœ¨**åŠŸèƒ½åŒ…å**ä¸º â€œpackage_for_launch_01â€ï¼Œè¯¥ launch æ–‡ä»¶å¯ä»¥ç¼–å†™ä¸ºå¦‚ä¸‹é…ç½®ï¼š

```python
from launch import LaunchDescription
from launch_ros.actions import Node

# å°è£…ç»ˆç«¯æŒ‡ä»¤ç›¸å…³ç±»------
from launch.actions import ExecuteProcess
from launch.substitutions import FindExecutable

"""
éœ€æ±‚ï¼š å¯åŠ¨ turtlesim_node èŠ‚ç‚¹ï¼Œå¹¶è°ƒç”¨æŒ‡ä»¤å¸¦æœ‰å¹´ä¹Œé¾Ÿçš„ä½å§¿ä¿¡æ¯
"""

def generate_launch_description():

    turtle = Node(
        package="turtlesim",
        executable="turtlesim_node",

    )

    # å°è£…æŒ‡ä»¤
    cmd = ExecuteProcess(
        # æ–¹å¼1 ç›´æ¥è¾“å…¥æŒ‡ä»¤
        # cmd=["ros2 topic echo /turtle1/pose"],
        # æ–¹å¼2 åˆ†åˆ«è¾“å…¥æŒ‡ä»¤ï¼ˆå¯ç”¨ï¼‰
        # cmd=["ros2 topic", "echo", "/turtle1/pose"],
        # æ–¹å¼3 ä½¿ç”¨å‡½æ•°å°è£…æŒ‡ä»¤ï¼ˆæ¨èï¼‰
        cmd=[FindExecutable(name="ros2"),"topic", "echo", "/turtle1/pose"],

        output = "both", # åŒæ—¶åœ¨ç£ç›˜æ–‡ä»¶ä¸ç»ˆç«¯å†…è¾“å‡ºæ—¥å¿—
        shell = True # å°†æŒ‡ä»¤ä½œä¸ºç»ˆç«¯æŒ‡ä»¤æ‰§è¡Œ
    )

    return LaunchDescription([turtle,cmd])
```

::: important ä½¿ç”¨ FindExecutable å‡½æ•°å°è£…æŒ‡ä»¤å¹¶éå¤šæ­¤ä¸€ä¸¾

åœ¨ExecuteProcessçš„cmdå‚æ•°ä¸­ä½¿ç”¨ä¸Šè¿°ä¸‰ç§æ–¹å¼å®é™…å„æœ‰ä¼˜åŠ£ï¼š

- **ç›´æ¥è¾“å…¥æŒ‡ä»¤**ä¼šä½¿æ•´ä¸ªå‘½ä»¤ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è¢«ä¼ è¾“ï¼Œè™½ç„¶å…¶ç®€å•ç›´è§‚ï¼Œä½†æ˜¯æ— æ³•åœ¨è¿è¡Œæ—¶ä¿®æ”¹å‚æ•°ï¼›
- **åˆ†åˆ«è¾“å…¥æŒ‡ä»¤**ç”±äºå‚æ•°åˆ†ç¦»ï¼Œç›¸å¯¹äº*ç›´æ¥è¾“å…¥æŒ‡ä»¤*è€Œè¨€æ›´æ˜“äºä¿®æ”¹ï¼Œä½†æ˜¯å…¶å‡å®šäº†ç¯å¢ƒå†…çš„å¯æ‰§è¡Œæ–‡ä»¶ä½ç½®å­˜åœ¨äº `ç³»ç»ŸPATHç¯å¢ƒå˜é‡` ä¸­ï¼›
- **ä½¿ç”¨å‡½æ•°å°è£…æŒ‡ä»¤**è™½ç„¶ä»…ä»…åªå°è£…äº†æœ€å‰é¢çš„ä¸€æ®µ`ros2`ä»£ç ï¼Œä½†æ˜¯ä½¿ç”¨`FindExecutable()`å¯ä»¥è®© ros2 åœ¨è¿è¡Œæ—¶åŠ¨æ€æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®ï¼Œå³ä½¿å½“å¼€å‘ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒã€å®¹å™¨ç¯å¢ƒå†…çš„å¯æ‰§è¡Œæ–‡ä»¶ä½ç½®ä¸åŒï¼Œæˆ–è€…åŒä¸€ç¯å¢ƒä¸‹å®‰è£…äº†å¤šä¸ªROS2ç‰ˆæœ¬æ—¶ï¼Œè¯¥æŒ‡ä»¤ä¾æ—§å¯ä»¥è¿è¡Œï¼Œä½¿å…¶è‡ªåŠ¨é€‚åº”å¤§éƒ¨åˆ†ç¯å¢ƒä¸å¤æ‚çš„éƒ¨ç½²åœºæ™¯ã€‚

:::

### 3. å‚æ•°è®¾ç½®-DeclareLaunchArgument&LaunchConfiguration

å‚æ•°è®¾ç½®ä¸»è¦æ¶‰åŠåˆ°å‚æ•°çš„ *å£°æ˜* ä¸ *è°ƒç”¨* ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­å£°æ˜è¢«å°è£…ä¸º `launch.actions.DeclareLaunchArgument`ï¼Œè°ƒç”¨åˆ™è¢«å°è£…ä¸º `launch.substitutions import LaunchConfiguration`ã€‚

å‡è®¾è¯¥ launch æ–‡ä»¶çš„**æ–‡ä»¶å**ä¸ºâ€œpy04_args_launch.pyâ€ï¼Œæ‰€åœ¨**åŠŸèƒ½åŒ…å**ä¸º â€œpackage_for_launch_01â€ï¼Œè¯¥ launch æ–‡ä»¶å¯ä»¥ç¼–å†™ä¸ºå¦‚ä¸‹é…ç½®ï¼š

```python
from launch import LaunchDescription
from launch_ros.actions import Node

# å‚æ•°å£°æ˜ä¸è·å–------
from launch.actions import DeclareLaunchArgument
from launch.substitutions import LaunchConfiguration

"""
éœ€æ±‚ï¼šåœ¨launchæ–‡ä»¶å¯åŠ¨æ—¶ï¼ŒåŠ¨æ€ä¿®æ”¹turtlesim_nodeçš„èƒŒæ™¯é¢œè‰²
å®ç°ï¼š
    1. å£°æ˜å‚æ•°ï¼ˆå˜é‡ï¼‰ï¼›
    2. è°ƒç”¨å‚æ•°ï¼ˆå˜é‡ï¼‰ï¼›
    3. æ‰§è¡Œlaunchæ–‡ä»¶æ—¶ï¼ŒåŠ¨æ€å¯¼å…¥å‚æ•°
"""

def generate_launch_description():
    # 1. å£°æ˜å‚æ•°ï¼ˆå˜é‡ï¼‰ï¼›
    decl_bg_r = DeclareLaunchArgument(name="bg_r",default_value="255")
    decl_bg_g = DeclareLaunchArgument(name="bg_g",default_value="25")

    # 2. è°ƒç”¨å‚æ•°ï¼ˆå˜é‡ï¼‰ï¼›
    turtle = Node(
        package="turtlesim",
        executable="turtlesim_node",
        parameters=[{
            "background_r": LaunchConfiguration(variable_name="bg_r"),
            "background_g": LaunchConfiguration(variable_name="bg_g")
        }]
    )
    return LaunchDescription([decl_bg_r,
                              decl_bg_g,
                              turtle])
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œä¸ºäº†å£°æ˜å‚æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†`DeclareLaunchArgument()` å‡½æ•°åˆ›å»ºäº†å¤šä¸ªå¯¹è±¡ï¼Œå…¶ä¸­ï¼š

- nameï¼šå‚æ•°åç§°ï¼›
- default_valueï¼šé»˜è®¤å€¼ã€‚

ä¹‹åæˆ‘ä»¬åœ¨åˆ›å»º `Node` å¯¹è±¡æ—¶å‘ `parameters` å‚æ•°å†…é€šè¿‡ `LaunchConfiguration()` å‡½æ•°ä¼ å…¥ä¸Šè¿° `å‚æ•°åç§°`ã€‚è¿™æ ·åœ¨ `launch` æ–‡ä»¶æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ `bash` åŠ¨æ€ä¼ å…¥å‚æ•°äº†ï¼š

```bash
ros2 launch cpp01_launch py04_args_launch.py background_r:=100 background_g:=86
```

å½“ç„¶ï¼Œå¦‚æœä¸ä¼ å…¥å‚æ•°ï¼Œåˆ™æ–‡ä»¶æ‰§è¡Œæ—¶ä¼šä½¿ç”¨å½“æ—¶å£°æ˜å‚æ•°æ—¶æ‰€ç»™å®šçš„é»˜è®¤å€¼ `default_value` è¿›è¡Œç›¸å…³è§£æã€‚

::: info åŠ¨æ€ä¼ å‚æ‰€ä½¿ç”¨çš„å‚æ•°åéœ€è¦åšåŒºåˆ«
é€šè¿‡ `bash` åŠ¨æ€ä¼ å…¥å‚æ•°æ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼šæ‰€ä¼ å…¥å‚æ•°ååº”ä¸ *æ‰€å¯¼å…¥çš„ `Node` å¯¹è±¡* å†…æ‰€ä½¿ç”¨çš„å‚æ•°å**ç›¸åŒ**ï¼Œè€Œ**å¹¶é**ä¸ *å£°æ˜å‚æ•°ï¼ˆå˜é‡ï¼‰æ—¶* æ‰€ä½¿ç”¨çš„å‚æ•°åç›¸åŒã€‚
:::

### 4.æ–‡ä»¶åŒ…å«-IncludeLaunchDescription&PythonLaunchDescriptionSource

æ–‡ä»¶åŒ…å«ä¸»è¦æŒ‡çš„æ˜¯å°†ä¸€ä¸ª `launch` æ–‡ä»¶ åŒ…å«è¿›å¦ä¸€ä¸ª `launch` æ–‡ä»¶çš„æ“ä½œã€‚å…¶éœ€è¦ä½¿ç”¨çš„ API ä¸º `launch.actions.IncludeLaunchDescription` & `PythonLaunchDescriptionSource`.

å‡è®¾è¯¥ launch æ–‡ä»¶çš„**æ–‡ä»¶å**ä¸ºâ€œpy05_include_launch.pyâ€ï¼Œæ‰€åœ¨**åŠŸèƒ½åŒ…å**ä¸º â€œpackage_for_launch_01â€ï¼Œä¸”å¸Œæœ›è°ƒç”¨ä¹‹å‰[å‚æ•°è®¾ç½®](#3-å‚æ•°è®¾ç½®-declarelaunchargumentlaunchconfiguration)é‡Œæ‰€ä½¿ç”¨çš„ `launch` æ–‡ä»¶ï¼Œåˆ™è¯¥ launch æ–‡ä»¶å¯ä»¥ç¼–å†™ä¸ºå¦‚ä¸‹é…ç½®ï¼š

```python
from launch import LaunchDescription
from launch_ros.actions import Node
import os
# æ–‡ä»¶åŒ…å«ç›¸å…³------
from launch.actions import IncludeLaunchDescription
from launch.launch_description_sources import PythonLaunchDescriptionSource
# è·å–åŠŸèƒ½åŒ…ä¸‹shareç›®å½•è·¯å¾„------
from ament_index_python.packages import get_package_share_directory
"""
    éœ€æ±‚ï¼š åœ¨å½“å‰ launch æ–‡ä»¶ä¸­åŒ…å«å…¶ä»– launch æ–‡ä»¶

"""
def generate_launch_description():
    include = IncludeLaunchDescription(
        launch_description_source=PythonLaunchDescriptionSource(
            launch_file_path=os.path.join(
                get_package_share_directory("cpp01_launch"),
                "launch",
                "py",
                "py04_args_launch.py"
            )
        )
    )
    return LaunchDescription([include])
```

è¿™æ ·åœ¨è¿è¡Œæ—¶å°±å¯ä»¥è°ƒç”¨ä¹‹å‰çš„ `launch` æ–‡ä»¶äº†ã€‚

å½“ç„¶ï¼Œè¿™æ ·è°ƒç”¨ `launch` æ–‡ä»¶æ—¶ï¼Œå…¶ä½¿ç”¨çš„å‚æ•°ä¸ºåŸæ–‡ä»¶å†…æ‰€ä½¿ç”¨çš„é»˜è®¤å€¼ `default_value`ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹å‚æ•°ï¼Œåˆ™å¯ä»¥åœ¨ä¸Šè¿°ä»£ç çš„åŸºç¡€ä¸Šä¿®æ”¹ä¸ºï¼š

```python
...
"""
    éœ€æ±‚ï¼š åœ¨å½“å‰ launch æ–‡ä»¶ä¸­åŒ…å«å…¶ä»– launch æ–‡ä»¶ï¼Œå¹¶ä¼ å…¥ç‰¹å®šå‚æ•°

"""
def generate_launch_description():
    include = IncludeLaunchDescription(
        launch_description_source=PythonLaunchDescriptionSource(
            launch_file_path=os.path.join(
                get_package_share_directory("cpp01_launch"),
                "launch",
                "py",
                "py04_args_launch.py"
            )
        ),launch_arguments=[("bg_r", "80"),("bg_g", "100")] #ğŸ‘ˆNEWï¼
    )
    return LaunchDescription([include])
```

::: important è®¾ç½®å‚æ•°åæ—¶éœ€æ³¨æ„
åœ¨ `IncludeLaunchDescription()` å‡½æ•°å†…é€šè¿‡ `launch_arguments` è¿›è¡Œå‚æ•°çš„å®šä¹‰æ—¶ï¼ŒåŠ¡å¿…ä½¿ç”¨åŸæ¥çš„ `launch` æ–‡ä»¶ä¸­ `DeclareLaunchArgument()` å‡½æ•°å†…æ‰€è®¾ç½®çš„å¯¹åº” `name`ï¼Œå¦åˆ™æ— æ³•è¯†åˆ«
:::

### 5. Nodeåˆ†ç»„-GroupAction&PushRosNamespace

åœ¨ launch æ–‡ä»¶ä¸­ä¸ºäº†æ–¹ä¾¿èŠ‚ç‚¹çš„ç®¡ç†ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹èŠ‚ç‚¹åˆ†ç»„ã€‚å…¶éœ€è¦ä½¿ç”¨çš„ API ä¸º `launch.actions.GroupAction` & `launch_ros.actions.PushRosNamespace`ã€‚å…¶ä¸­ï¼š

- GroupActionï¼šåˆ†ç»„ç”¨çš„æ ¸å¿ƒ API
- PushRosNamespaceï¼šä¸ºå½“å‰ç»„è®¾ç½®å‘½åç©ºé—´

å‡è®¾è¯¥ launch æ–‡ä»¶çš„**æ–‡ä»¶å**ä¸ºâ€œpy06_group_launch.pyâ€ï¼Œæ‰€åœ¨**åŠŸèƒ½åŒ…å**ä¸º â€œpackage_for_launch_01â€ï¼Œåˆ™è¯¥ launch æ–‡ä»¶å¯ä»¥ç¼–å†™ä¸ºå¦‚ä¸‹é…ç½®ï¼š

```python
from launch import LaunchDescription
from launch_ros.actions import Node
# åˆ†ç»„ç›¸å…³------
from launch_ros.actions import PushRosNamespace
from launch.actions import GroupAction

"""
    éœ€æ±‚ï¼š åˆ›å»º 3 ä¸ª turtlesim_node, å¹¶å‰ä¸¤ä¸ªåˆ’åˆ†ä¸ºåŒä¸€ç»„ï¼Œç¬¬ä¸‰ä¸ªå•ç‹¬ä¸€ç»„
"""
def generate_launch_description():
    # åˆ›å»º 3 ä¸ª turtlesim_node
    t1 = Node(
        package="turtlesim",
        executable="turtlesim_node",
        name="t1"
    )
    t2 = Node(
        package="turtlesim",
        executable="turtlesim_node",
        name="t2"
    )
    t3 = Node(
        package="turtlesim",
        executable="turtlesim_node",
        name="t3"
    )
    # åˆ†ç»„
    # è®¾ç½®å½“å‰ç»„å‘½åç©ºé—´ï¼Œä»¥åŠåŒ…å«çš„èŠ‚ç‚¹
    g1 = GroupAction(actions=[PushRosNamespace("g1"), t1, t2])
    g2 = GroupAction(actions=[PushRosNamespace("g2"), t3])
    return LaunchDescription([g1, g2])
```

è¿™æ ·å½“è¯¥ `launch` æ–‡ä»¶è¿è¡Œæ—¶ï¼Œåªéœ€è¦å¦å¼€ä¸€ç»ˆç«¯ï¼Œå¹¶åœ¨ `bash` å†…è¾“å…¥`ros2 node list`, å³å¯æŸ¥çœ‹åˆ°è¿™å‡ ä¸ª `node` çš„åˆ†ç»„æƒ…å†µäº†:

![nodeåˆ†ç»„æƒ…å†µ](./assets/2026-01-21_001.jpg)

::: info å¦‚æœåœ¨åˆ›å»º `Node` å¯¹è±¡æ—¶ä½¿ç”¨äº† `namespace` çš„è¯...
å‡è®¾åœ¨åŸæ¥ä»£ç çš„åŸºç¡€ä¸Šï¼Œå°† `t1` ä¿®æ”¹ä¸ºäº†å¦‚ä¸‹é…ç½®ï¼š

```python
...
t1 = Node(
        package="turtlesim",
        executable="turtlesim_node",
        name="t1",
        namespace="extra1" # ğŸ‘ˆNEW!
    )
...

```

åˆ™å½“è¯¥ `launch` æ–‡ä»¶è¿è¡Œæ—¶ï¼Œ`Node` çš„åˆ†ç»„æƒ…å†µå°±ä¼šå˜ä¸ºï¼š

![nodeåˆ†ç»„æƒ…å†µ-extra](./assets/2026-01-21_002.jpg)

æœ¬è´¨ä¸Šå°±æ˜¯åœ¨å¤šå¥—äº†ä¸€ä¸ªå‘½åç©ºé—´åœ¨æŒ‡å®š `Node` ä¸Šè¿™æ · = =
:::

### 6. äº‹ä»¶è§¦å‘-RegisterEventHandler&OnProcessStart&OnProcessExit

å½“ä½¿ç”¨ `luanch` æ–‡ä»¶è¿è¡ŒèŠ‚ç‚¹æ—¶ï¼ŒèŠ‚ç‚¹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šè§¦å‘ä¸åŒçš„äº‹ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº› `API` ä¸ºå…¶æ³¨å†Œä¸€å®šçš„å¤„ç†é€»è¾‘ã€‚

ç›¸å…³çš„ API ä¸ºï¼š

- launch.actions.RegisterEventHandler æ³¨å†Œäº‹ä»¶
- launch.event_handlers.OnProcessStart å½“èŠ‚ç‚¹è¢«åˆ›å»ºæ—¶è§¦å‘
- launch.event_handlers.OnProcessExit å½“èŠ‚ç‚¹å°†è¢«é”€æ¯æ—¶è§¦å‘

åœ¨ä»¥ä¸‹çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¼šç»“åˆå‰æ–‡æ‰€è¿°çš„[æ‰§è¡ŒæŒ‡ä»¤è®¾ç½®](#2-æ‰§è¡ŒæŒ‡ä»¤è®¾ç½®-executeprocess)ï¼Œå°†å…¶å°è£…è¿› API ä¸­ã€‚

```python
from launch import LaunchDescription
from launch_ros.actions import Node
# å°è£…ç»ˆç«¯æŒ‡ä»¤ç›¸å…³ç±»------
from launch.actions import ExecuteProcess
# äº‹ä»¶ç›¸å…³------
from launch.event_handlers import OnProcessStart, OnProcessExit
from launch.actions import RegisterEventHandler, LogInfo
"""
    éœ€æ±‚ï¼š ä¸º turtlesim_node ç»‘å®šäº‹ä»¶
        ä¸€ï¼š èŠ‚ç‚¹å¯åŠ¨æ—¶ï¼Œæ‰§è¡Œâ€œç”Ÿæˆæ–°çš„å°ä¹Œé¾Ÿâ€ç¨‹åº
        äºŒï¼š èŠ‚ç‚¹å…³é—­æ—¶ï¼Œæ‰§è¡Œæ—¥å¿—è¾“å‡ºæ“ä½œ
"""
def generate_launch_description():
    turtle = Node(
        package="turtlesim",
        executable="turtlesim_node"
    )
    # å‡è®¾å¸Œæœ›å°è£…çš„ä»£ç ä¸ºï¼š
    # ros2 service call /spawn turtlesim/srv/Spawn "{'x':8.0, 'y':3.0}"
    # åˆ™å¯ä»¥è¢«å†™ä¸ºï¼š
    spawn = ExecuteProcess(
        cmd=["ros2 service call /spawn turtlesim/srv/Spawn \"{'x':8.0, 'y':3.0}\""],
        output="both",
        shell=True
    )
    # æ³¨å†Œäº‹ä»¶1
    event_start = RegisterEventHandler(
        event_handler=OnProcessStart(
            target_action=turtle,
            on_start=spawn
        )
    )
    # æ³¨å†Œäº‹ä»¶2
    event_exit = RegisterEventHandler(
        event_handler=OnProcessExit(
            target_action=turtle,
            on_exit=[LogInfo(msg="turtlesim_node å·²é€€å‡º")]
        )
    )

    return LaunchDescription([turtle, event_start, event_exit])
```

ä¸Šè¿°ä»£ç ä¸º `turtle` èŠ‚ç‚¹æ³¨å†Œäº†å¯åŠ¨äº‹ä»¶ï¼ˆäº‹ä»¶1ï¼‰å’Œé€€å‡ºäº‹ä»¶ï¼ˆäº‹ä»¶2ï¼‰ï¼Œå½“ `turtle` èŠ‚ç‚¹å¯åŠ¨åä¼šæ‰§è¡Œ `spawn` ï¼Œå½“ `turtle` èŠ‚ç‚¹é€€å‡ºæ—¶ï¼Œä¼šè¾“å‡ºæ—¥å¿—æ–‡æœ¬ï¼š`â€œturtlesim_node å·²é€€å‡ºâ€`ã€‚å…¶ä¸­ï¼š

å¯¹è±¡ `RegisterEventHandler` è´Ÿè´£æ³¨å†Œäº‹ä»¶ï¼Œå…¶å‚æ•°ä¸ºï¼š

- `event_handler`ï¼šæ³¨å†Œçš„äº‹ä»¶å¯¹è±¡ã€‚

`OnProcessStart` æ˜¯å¯åŠ¨äº‹ä»¶å¯¹è±¡ï¼Œå…¶å‚æ•°ä¸ºï¼š

- `target_action`ï¼šè¢«æ³¨å†Œäº‹ä»¶çš„ç›®æ ‡å¯¹è±¡ï¼›
- `on_start`ï¼šäº‹ä»¶è§¦å‘æ—¶çš„æ‰§è¡Œé€»è¾‘ã€‚

`OnProcessExit` æ˜¯é€€å‡ºäº‹ä»¶å¯¹è±¡ï¼Œå…¶å‚æ•°ä¸ºï¼š

- `target_action`ï¼šè¢«æ³¨å†Œäº‹ä»¶çš„ç›®æ ‡å¯¹è±¡
- `on_exit`ï¼šäº‹ä»¶è§¦å‘æ—¶çš„æ‰§è¡Œé€»è¾‘

`LogInfo` æ˜¯æ—¥å¿—è¾“å‡ºå¯¹è±¡ï¼Œå…¶å‚æ•°ä¸ºï¼š

- `msg`ï¼šè¢«è¾“å‡ºçš„æ—¥å¿—ä¿¡æ¯ã€‚

ä½ åŒæ—¶å¯ä»¥å‚è€ƒ[**ä¸‹ä¸€ç¯‡**](./2026_01_29.md)å†…å®¹ï¼Œé‚£é‡Œè¯¦ç»†çš„ä»‹ç»äº†ä½¿ç”¨[XML]ã€[YAML] ä¸¤ç§è¯­è¨€ç¼–å†™ **launch æ–‡ä»¶** æ—¶æ‰€æ¶‰åŠçš„ç›¸å…³è¯­æ³•ã€‚å¯ä»¥å°†è¿™ä¸€ç¯‡çš„å†…å®¹ä¸ä¸‹ä¸€ç¯‡è¿›è¡Œæ¯”è¾ƒã€‚
